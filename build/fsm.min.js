DEBUG=!0,
/**
 * @license
 * The MIT License (MIT)
 *
 * Copyright (c) Joel F Guillod <joel.guillod@gmail.com> (www.imed.ch)
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
function(t){"use strict";if("function"==typeof bootstrap)bootstrap("jsfsm",t);else if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else{if("undefined"==typeof self)throw"This environment was not anticipated by imed-javascript-finite-state-machine. Please file a bug.";self.FSM=t()}}(function(){"use strict";var t=function(t,r){var i,o,s=this,a=this._transitions={},c=this._states={},f=this._fromStates={},u=t._,h=this._private=Object.assign({initial:"none"},u);h.justListen=!1!==h.justListen,this._listeners=[],this.e={},this.original=function(){return s},Object.freeze(this.original),Object.getOwnPropertyNames(t).forEach(function(n){i=t[n],"_"!=n&&(i.entry||i.exit||i.actions?(c[n]=i,!i.exit||i.exit instanceof Array||(i.exit=[i.exit]),!i.entry||i.entry instanceof Array||(i.entry=[i.entry]),i.hasOwnProperty("actions")||(i.actions={})):(a[n]=i instanceof Array?i:[i],this.e[n]||(this.e[n]=e(this,n))))},this),Object.getOwnPropertyNames(a).forEach(function(t){a[t].forEach(function(e){!e.before||e.before instanceof Array||(e.before=[e.before]),!e.after||e.after instanceof Array||(e.after=[e.after]),!e.do||e.do instanceof Array||(e.do=[e.do]),!e.guard||e.guard instanceof Array||(e.guard=[e.guard]),!e.dont||e.dont instanceof Array||(e.dont=[e.dont]),e.from&&!c[e.from]&&(c[e.from]={}),e.to&&!c[e.to]&&(c[e.to]={}),o=e.from||"none",f[o]||(f[o]={}),f[o][t]=e,Object.freeze(e),Object.freeze(f[o][t]),Object.freeze(c[e.from]),Object.freeze(c[e.to])})},this),Object.freeze(a),Object.freeze(c),Object.freeze(f),Object.freeze(h),Object.freeze(this.e),this._pendingTransition=!1,this._lockKey=null,this._lifeCycle=[],n(this,h.initial),"function"==typeof r&&r.call(this,this)};function e(t,e){return function(n){for(var r=0,i=arguments.length,o=new Array(i);r<i;++r)o[r]=arguments[r];return t.trigger.apply(t,[e].concat(o))}}function n(t,e,n){if(t._addHistory(e,n),t._current=e,!t._states.hasOwnProperty(e))throw'unknown state "'+e+"'";t._actions=Object.assign({},t._states[e].actions)}function r(t,e,n,r){var i=n.guard;var o={step:"guard",event:e,from:n.from,to:n.to,options:n.options};return!i||i.every(function(e){return!e||e.apply(t,[o].concat(r))})}return Object.defineProperty(t.prototype,"actions",{get(){return this._actions}}),t.prototype.factory=function(t,r){var i=Object.getOwnPropertyNames(this.e),o=this._private.initial;function s(t,r){1===arguments.length&&"function"==typeof t&&(cb=t,t=null),this._debug=!1,this._pendingTransition=!1,this._listeners=[],this._lockKey=null,this._lifeCycle=[],this._initial="",this.reason=null,n(this,t||o),this.e={},i.forEach(function(t){this.e[t]=e(this,t)},this),Object.freeze(this.e),"function"==typeof r&&r.call(this,this)}return s.prototype=this,new s(t,r)},t.prototype.resetMachine=function(t){if(this.isLocked()&&!this.testLock(t))throw"Reseting machine is forbidden by a lock";if(this._pendingTransition)throw"Reseting machine is forbidden during a transition";n(this,this._private.initial)},t.prototype.engineVersion=function(){return"JFG's FSM engine v 0.8.1 Tue Feb 16 2016 13:02:36 GMT+0100 (CET)"},t.prototype.version=function(){return this._private.version||"unknown"},t.prototype.lock=function(){if(this.isLocked())throw"Machine is already locked";return this._lockKey=arguments[0]||{}},t.prototype.unlock=function(t){return this._lockKey&&t===this._lockKey&&(this._lockKey=null),null===this._lockKey},t.prototype.testLock=function(t){return t===this._lockKey},t.prototype.isLocked=function(){return null!==this._lockKey},t.prototype.status=function(){var t={engine:this.engineVersion(),version:this.version(),state:this._current,pending:this._pendingTransition};return this._private.namespace&&(t.namespace=this._private.namespace),t},t.prototype.current=function(){return this._current},t.prototype._addHistory=function(t,e){var n={date:new Date,to:t};this._current&&(n.from=this._current),e&&(n.event=e),Object.freeze(n),this._lifeCycle.push(n)},t.prototype.history=function(){return this._lifeCycle.concat()},t.prototype.on=function(t,e,n){var r=3,i=n;"function"==typeof e&&(i=e,e=this,r=2);for(var o=arguments.length,s=[];r<o;++r)s.push(arguments[r]);return function(t,e,n,r,i){var o={fn:r,scope:n};return i.length>0&&(o.options=i),t._listeners.length+1===t._listeners.push({pattern:e,observer:o})}(this,t,e,i,s)},t.prototype.un=function(t,e,n){var r=n;return"function"==typeof e&&(r=e,e=this),function(t,e,n,r){var i=t._listeners.length;return t._listeners=t._listeners.filter(function(t){var i=t.observer.fn,o=t.observer.scope;return t.pattern!=e.toString()||n!==o||r!==i}),i>t._listeners.length}(this,t,e,r)},t.prototype.availActions=function(){return Object.getOwnPropertyNames(this.actions)},t.prototype.availEvents=function(t){for(var e=this._fromStates[this._current],n=this,i=1,o=arguments.length,s=o>i?new Array(o-i):[];i<o;++i)s[i-1]=arguments[i];return Object.getOwnPropertyNames(e).filter(function(i){return!0!==t||r(n,i,e[i],s)})},t.prototype.can=function(t,e){if(0===arguments.length)return!1;for(var n=2,i=arguments.length,o=i>n?new Array(i-n):[];n<i;++n)o[n-2]=arguments[n];return!0===e?r(this,t,this._fromStates[this._current][t],o):this._fromStates[this._current].hasOwnProperty(t)},t.prototype.is=function(t){return this._current===t},t.prototype._fsmListeners=function(t,e){var n,r=this,i=this._private.justListen,o=t.event,s=t.to,a=t.from,c=t.state,f=t.step+(c?"-"+c:(o?"-"+o:"")+(a?"-"+a:"")+(s?"-"+s:"")),u=r._listeners,h=Object.assign({},t);try{n=u.every(function(t){var n,r=t.pattern,o=t.observer,s=o.fn,a=o.scope,c=o.options,u=Object.freeze(Object.assign(c?{options:c}:{},h)),p=!0;return(r instanceof RegExp?r.test(f):r===f)&&(n=[u].concat(e),p=s.apply(a,n)),p||i})}finally{0}return n},t.prototype.recoverPendingTransition=function(){this._pendingTransition=!1},t.prototype.isInTransition=function(){return this._pendingTransition},t.prototype.trigger=function(t){var e=1;if(this.isLocked()){if(!this.testLock(arguments[1]))return this.reason="Trigger is forbidden by a lock",!1;e=2}if(this._pendingTransition)return this.reason="Cannot trigger '"+arguments[e]+"' : previous transition is not completed",!1;this._pendingTransition=!0;for(var r=arguments.length,i=[];e<r;++e)i.push(arguments[e]);var o=function(t,e,r){var i=t._current,o=t._fromStates[i][e],s=!0,a=t._private.justListen;if(r=r||[],t.reason=null,!o)return t.reason="Cannot trigger '"+e+"' : undefined transition in current state '"+i+"'",!1;var c=o.to,f=o.options,u={event:e,from:i},h={state:i},p={state:c};c&&(u.to=c);function l(e,n,i){n.step=e;var o,s,c={};f&&(c.options=f);try{c=Object.freeze(Object.assign(c,n)),s=[c].concat(r),o=!i||i.every(function(e){return!e||e.apply(t,s)})}finally{0,a?t._fsmListeners(n,r):o=o&&t._fsmListeners(n,r)}return o}function y(){return l("dont",u,o.dont)}try{if(!0!==l("before",u,o.before))throw"before cancelled the transition";if(!0!==l("guard",u,o.guard))throw y(),"guard cancelled the transition";if(c){if(!0!==l("exit",h,t._states[i].exit))throw y(),"exit cancelled the transition";t._actions={}}l("do",u,o.do),c&&(n(t,c,e),l("entry",p,t._states[c].entry))}catch(e){0,t.reason=e,s=!1}finally{try{l("after",u,o.after)}catch(e){0,t.reason={error:e,step:"after"},s=!1}0}return s}(this,t,i);return this._pendingTransition=!1,o},t.prototype.t=t.prototype.trigger,Object.defineProperty(t.prototype,"debug",{set:function(t){this._debug=!!this.logger&&!!(t&&console&&console.log&&console.time&&console.timeEnd)},get:function(){return this._debug}}),t});